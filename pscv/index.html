<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>台本ビューア</title>
<meta name="viewport" content="width=device-width">
<link rel="stylesheet" type="text/css" href="styles/app.css">
<link rel="stylesheet" type="text/css" href="styles/psc.css">
<link rel="manifest" href="manifest.json">
</head>
<body>

<header class="app-header">
  <img id="tocButton" class="header-button" src="img/list.png" />
  <h1 id="headerTitle" class="header-title"></h1>
  <img id="settingButton" class="header-button" src="img/gear.png" />
</header>

<main id="main"></main>

<nav id="toc" class="modal">
  <div class="overlay"></div>
  <div class="app-toc panel">
    <div class="panel-header">
      <h2>目次</h2>
      <img id="tocCloseButton" class="panel-header-button" src="img/close.png" />
    </div>
    <ul id="tocList" class="toc-list"></ul>
  </div>
</nav>

<div id="setting" class="modal">
  <div class="overlay"></div>
  <div class="app-setting panel">
    <div class="panel-header">
      <h2>設定</h2>
      <img id="settingCloseButton" class="panel-header-button" src="img/close.png" />
    </div>
    <p class="setting-item">台本を読み込む</p>
    <div>
      <select id="scSelect">
      </select>
      <button id="scLoadButton">読込</button>
    </div>
    <div>
      <button id="scReloadButton">再取得</button>
      <button id="scAddButton">新規</button>
      <button id="scDeleteButton">削除</button>
    </div>
    <p class="setting-item">文字サイズ</p>
    <div>
      <select id="fontSizeSelect">
      </select>
    </div>
    <p class="setting-item">向き</p>
    <div>
      <select id="writingModeSelect">
        <option value='0'>横書き</option>
        <option value='1'>縦書き</option>
        <option value='2'>縦書き (英数字も)</option>
      </select>
    </div>
    <p class="setting-item">セリフの色</p>
    <p class="setting-item">役のアイコン</p>
    <p class="setting-item">台本ビューア</p>
    <p>Ver. <span id="appVersion"></span></p>
    <button id="updateButton">更新</button>
  </div>
</div>

<script src="scripts/app.js"></script>
<script src="scripts/back.js"></script>
<script src="scripts/psc.js"></script>
<script type="application/javascript">
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.getRegistration()
  .then (registration => {
    // 登録中の SW がなければ、これが初回登録である
    const firstRegistration = (registration === undefined);
    // SW を登録する
    navigator.serviceWorker.register('sw.js')
    .then(registration => {
      // 初回登録でなければ更新が見つかったかチェックする
      if (!firstRegistration) {
        registration.addEventListener('updatefound', () => {
          const installingWorker = registration.installing;
          if (installingWorker != null) {
            installingWorker.onstatechange = e => {
              if (e.target.state == 'installed')
                alert('更新がインストールされました。台本ビューアを再起動してください。');
            };
          }
        });
      }
    });
  });
}
</script>

</body>
</html>
